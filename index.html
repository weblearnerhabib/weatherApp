<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8">
  <title>Weather App By Arjun Sethiya</title>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css'>
<link rel='stylesheet' href='https://fonts.font.im/css?family=Varela+Round'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css'>
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'><link rel="stylesheet" href="./style.css">
<style type="text/css">
  h1, h3, h4, h5{
  margin: 0px;
  padding: 20px 20px;
}
h1 {
    font-size: 2.2rem;
    line-height: 100%;
    font-weight: 800;
}
h6{
  margin: 0px;
  padding: 25px 20px;
  line-height: 1.7;
}

body {
  font-family: 'Varela Round', sans-serif;
  color: white;
  text-align: center;
}

#weather_desc {
  font-size: 25px;
}

#weather_icon {
  font-size: 50px;
}
.purple.lighten-3 {
    background-color: #000000 !important;
}
.orange.lighten-2 {
    background-color: #ffffff !important;
    color: black;
}
.yellow.lighten-1 {
    background-color: #ffffff !important;
    color: black;
}
.green.lighten-2 {
    display: inline-block;
    background-color: #3b523b !important;
}
.cyan.lighten-3 {
    display: inline-block;
    background-color: #55959d !important;
}
.btn-floating.btn-large {
    width: 106px;
    height: 106px;
}
.btn-floating.btn-large i {
    line-height: 108px;
}
.btn-large i {
    font-size: 3.6rem;
}
.fixed-action-btn ul{
  bottom: 114px;
}
a.modal-trigger,a#current_city {
    transform: scale(1.5);
    width: 80px;
    height: 80px;
}
.btn-floating i {
    font-size: 2.6rem;
    line-height: 75px;
}
.red.lighten-2 {
    height: 200px;
}

.red.lighten-2 a {
    margin-top: 16px;
    background: #0dc6fd !important;
}
</style>
</head>
<body>
<div class="red lighten-2">
  <h1>Weather App By Arjun</h1>
  <a id="current_city" class="btn-floating light-green tooltipped" data-position="left" data-delay="50" data-tooltip="Click me to see the weather of your city" data-tooltip-id="603af54b-d65b-2fa6-3191-6eb4b0859636"><i class="fa fa-location-arrow" aria-hidden="true"></i></a></li>
</div>
<div class="orange lighten-2">
  <h3>
    <span id="temp">Temp</span>&nbsp
    <span id="weather_icon"></span>
    <span id="weather">Weather</span>
  </h3>
</div>
<div class=" yellow lighten-1">
  <h4>
    <span id="city">City</span>&nbsp
    <small>
      <span id="location"></span>
    </small>
  </h4>
</div>

<div class="arjun">
  <div class="green lighten-2">
  <h5>
    Wind speed: <span id="wind_speed"></span>&nbsp
    Cloudiness: <span id="cloudiness"></span>
  </h5>
</div>
<br/>
<div class="cyan lighten-3">
  <h5>
    Humidity: <span id="humidity"></span>&nbsp
    Pressure: <span id="pressure"></span>
  </h5>
</div>
</div>

<div class="purple lighten-3">
  <h6>
    Last update: <span id="time"></span><br />
    All the data is provided by <a class="white-text" href="https://openweathermap.org/" target="_blank"><i>OpenWeatherMap</i></a><br \>
    <span style="font-weight: bold; color: red;"> 
    Designed And Developed By Arjun Sethiya </span>
  </h6>
</div>
<div id="modal_forecast" class="modal modal-fixed-footer black-text">
  <div class="modal-content">
    <h4>Weather Forecast</h4>
    <table class="highlight centered">
      <thead>
        <tr>
          <th>Time</th>
          <th>Weather</th>
          <th>Temp</th>
        </tr>
      </thead>
      <tbody id="forecast">
      </tbody>
    </table>
  </div>
  <div class="modal-footer">
    <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat"><i class="fa fa-window-close-o" aria-hidden="true"></i> Close</a>
    <a class="modal-trigger modal-action modal-close waves-effect waves-green btn-flat" href="#modal_search"><i class="fa fa-search" aria-hidden="true"></i> <span id="city_now">City</span></a>
  </div>
</div>
<div class="fixed-action-btn">
  <a class="btn-floating btn-large pulse amber darken-4 tooltipped" data-position="left" data-delay="50" data-tooltip="More Function">
    <i class="fa fa-navicon" aria-hidden="true"></i>
  </a>
  <ul>
    <li><a class="modal-trigger btn-floating light-blue lighten-3 tooltipped" href="#modal_forecast" data-position="left" data-delay="50" data-tooltip="Click me to see forecast"><i class="fa fa-snowflake-o" aria-hidden="true"></i></a></li>
    <li><a class="modal-trigger btn-floating pink lighten-3 tooltipped" href="#modal_search" data-position="left" data-delay="50" data-tooltip="Click me to choose city"><i class="fa fa-search" aria-hidden="true"></i></a></li>
    <li><a id="current_city" class="btn-floating light-green tooltipped" data-position="left" data-delay="50" data-tooltip="Click me to see the weather of your city"><i class="fa fa-location-arrow" aria-hidden="true"></i></a></li>
  </ul>
</div>
<div id="modal_search" class="modal black-text">
  <div class="modal-content">
    <h4>Choose City</h4>
    <div class="input-field container">
      <i class="fa fa-home prefix" aria-hidden="true"></i>
      <input id="icon_prefix" type="text" class="validate">
      <label for="icon_prefix">&nbsp e.g. Delhi or Mumbai</label>
    </div>
  </div>
  <div class="modal-footer">
    <button id="city_submit" class="modal-action modal-close waves-effect waves-green btn-flat "><i class="fa fa-paper-plane" aria-hidden="true"></i>&nbsp OK!</button>
  </div>
</div>
<!-- partial -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js'></script>

<script type="text/javascript">
  $(document).ready(function(){
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(success);
  }
  $(".modal").modal();
  $("#city_submit").click(function(){
    var cityName = $("#icon_prefix").val();
    $("#icon_prefix").val("");
    $("#location").html("");
    getWeatherByCityName(cityName);
    getForecastByCityName(cityName);
  });
  $("#icon_prefix").keypress(function(event){
    if(event.keyCode == "13"){
      $("#city_submit").trigger("click");
    }
  });
  $("#current_city").click(function(){
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(success);
    }
  });
});

function success(position) {
  var latitude = position.coords.latitude;
  var longitude = position.coords.longitude;
  // var latitude = 30;
  // var longitude = -10;
  setLoc(latitude, longitude);
  getWeather(latitude, longitude);
  getForecast(latitude, longitude);
}

function setLoc(latitude, longitude){
  if(latitude >= 0){
    latitude = Math.round(latitude) + "<small>°N</small>";
  }
  else{
    latitude = Math.round(latitude) + "<small>°S</small>";
  }
  if(longitude >= 0){
    longitude = Math.round(longitude) + "<small>°E</small>";
  }
  else{
    longitude = Math.round(longitude) + "<small>°W</small>";
  }
  $("#location").html(latitude + ", " + longitude);
}

var appid = "c231437c38aeccd6596f746f3e95b155";
var units = "metric";

function getWeather(latitude, longitude){
  $.ajax({
    url: "https://api.openweathermap.org/data/2.5/weather?lang=zh_cn&units=" + units + "&appid=" + appid + "&lat=" + latitude + "&lon=" + longitude,
    success: function(json){
      console.log(json);
      $("#weather").html(json.weather[0].main);
      $("#weather_desc").html("(" + json.weather[0].description + ")");
      $("#weather_icon").html(getWeatherIcon(json.weather[0].id));
      $("#temp").html(json.main.temp + "<small>℃</small>");
      $("#pressure").html(json.main.pressure + "hPa");
      $("#humidity").html(json.main.humidity + "%");
      $("#wind_speed").html(json.wind.speed + "meter/sec");
      $("#cloudiness").html(json.clouds.all + "%");
      $("#city").html(json.name + ", " + counTrans[json.sys.country]);
      $("#time").html(dateTransform(json.dt));
      $("#sunrise_time").html(timeTransform(json.sys.sunrise));
      $("#sunset_time").html(timeTransform(json.sys.sunset));
    }
  });
}

function getWeatherByCityName(cityName){
  $.ajax({
    url: "https://api.openweathermap.org/data/2.5/weather?lang=zh_cn&units=" + units + "&appid=" + appid + "&q=" + cityName,
    success: function(json){
      $("#weather").html(json.weather[0].main);
      $("#weather_desc").html("(" + json.weather[0].description + ")");
      $("#weather_icon").html(getWeatherIcon(json.weather[0].id));
      $("#temp").html(json.main.temp + "<small>℃</small>");
      $("#pressure").html(json.main.pressure + "hPa");
      $("#humidity").html(json.main.humidity + "%");
      $("#wind_speed").html(json.wind.speed + "meter/sec");
      $("#cloudiness").html(json.clouds.all + "%");
      $("#city").html(json.name + ", " + counTrans[json.sys.country]);
      $("#time").html(dateTransform(json.dt));
      $("#sunrise_time").html(timeTransform(json.sys.sunrise));
      $("#sunset_time").html(timeTransform(json.sys.sunset));
    }
  });
}

function getForecast(latitude, longitude){
  $.ajax({
    url: "https://api.openweathermap.org/data/2.5/forecast?lang=zh_cn&units=" + units + "&appid=" + appid + "&lat=" + latitude + "&lon=" + longitude,
    success: function(json){
      var html = "";
      for(var i = 0; i < json.cnt; i++){
        html += "<tr>";
        html += "<td>"
        html += json.list[i].dt_txt;
        html += "</td>";
        html += "<td>";
        html += getWeatherIcon(json.list[i].weather[0].id);
        html += "</td>";
        html += "<td>";
        html += json.list[i].main.temp_min.toFixed(2);
        html += "℃~";
        html += json.list[i].main.temp_max.toFixed(2);
        html += "℃";
        html += "</td>";
        html += "</tr>";
      }
      $("#forecast").html(html);
      $("#city_now").html(json.city.name);
    }
  });
}

function getForecastByCityName(cityName){
  $.ajax({
    url: "https://api.openweathermap.org/data/2.5/forecast?lang=zh_cn&units=" + units + "&appid=" + appid + "&q=" + cityName,
    success: function(json){
      var html = "";
      for(var i = 0; i < json.cnt; i++){
        html += "<tr>";
        html += "<td>"
        html += json.list[i].dt_txt;
        html += "</td>";
        html += "<td>";
        html += getWeatherIcon(json.list[i].weather[0].id);
        html += "</td>";
        html += "<td>";
        html += json.list[i].main.temp_min.toFixed(2);
        html += "℃~";
        html += json.list[i].main.temp_max.toFixed(2);
        html += "℃";
        html += "</td>";
        html += "</tr>";
      }
      $("#forecast").html(html);
      $("#city_now").html(json.city.name);
    }
  });
}

function timeTransform(unix_time) {
  var data = new Date(unix_time*1000);
  return data.toLocaleTimeString();
}

function dateTransform(unix_time) {
  var data = new Date(unix_time*1000);
  return data.toLocaleString();
}

function getWeatherIcon(iconId) {
  var icon = "";
  if(iconId >= 200 && iconId < 300){
    icon = "thunderstorm";
  }
  else if(iconId >= 300 && iconId < 400){
    icon = "rain-mix";
  }
  else if(iconId >= 500 && iconId < 600){
    icon = "rain";
  }
  else if(iconId >= 600 && iconId < 700){
    icon = "snow";
  }
  else if(iconId >= 700 && iconId < 800){
    icon = "fog";
  }
  else if(iconId == 800){
    icon = "day-sunny";
  }
  else if(iconId > 800 && iconId < 900){
    icon = "cloud";
  }
  icon = "<i class='wi wi-" + icon + "'></i>";
  return icon;
}

var counTrans = {   
 "AO": "Angola",   
 "AF": "Afghanistan",   
 "AL": "Albania",   
 "DZ": "Algeria",   
 "AD": "Andorra",   
 "AI": "Anguilla",   
 "AG": "Barbuda Antigua",   
 "AR": "Argentina",   
 "AM": "Armenia",   
 "AU": "Australia",   
 "AT": "Austria",   
 "AZ": "Azerbaijan",   
 "BS": "Bahamas",   
 "BH": "Bahrain",   
 "BD": "Bangladesh",   
 "BB": "Barbados",   
 "BY": "Belarus",   
 "BE": "Belgium",   
 "BZ": "Belize",   
 "BJ": "Benin",   
 "BM": "Bermuda Is.",   
 "BO": "Bolivia",   
 "BW": "Botswana",   
 "BR": "Brazil",   
 "BN": "Brunei",   
 "BG": "Bulgaria",   
 "BF": "Burkina-faso",   
 "MM": "Burma",   
 "BI": "Burundi",   
 "CM": "Cameroon",   
 "CA": "Canada",   
 "CF": "Central African Republic",   
 "TD": "Chad",   
 "CL": "Chile",   
 "CN": "China",   
 "CO": "Colombia",   
 "CG": "Congo",   
 "CK": "Cook Is.",   
 "CR": "Costa Rica",   
 "CU": "Cuba",   
 "CY": "Cyprus",   
 "CZ": "Czech Republic",   
 "DK": "Denmark",   
 "DJ": "Djibouti",   
 "DO": "Dominica Rep.",   
 "EC": "Ecuador",   
 "EG": "Egypt",   
 "SV": "EI Salvador",   
 "EE": "Estonia",   
 "ET": "Ethiopia",   
 "FJ": "Fiji",   
 "FI": "Finland",   
 "FR": "France",   
 "GF": "French Guiana",   
 "GA": "Gabon",   
 "GM": "Gambia",   
 "GE": "Georgia",   
 "DE": "Germany",   
 "GH": "Ghana",   
 "GI": "Gibraltar",   
 "GR": "Greece",   
 "GD": "Grenada",   
 "GU": "Guam",   
 "GT": "Guatemala",   
 "GN": "Guinea",   
 "GY": "Guyana",   
 "HT": "Haiti",   
 "HN": "Honduras",   
 "HK": "Hongkong",   
 "HU": "Hungary",   
 "IS": "Iceland",   
 "IN": "India",   
 "ID": "Indonesia",   
 "IR": "Iran",   
 "IQ": "Iraq",   
 "IE": "Ireland",   
 "IL": "Israel",   
 "IT": "Italy",   
 "JM": "Jamaica",   
 "JP": "Japan",   
 "JO": "Jordan",   
 "KH": "Kampuchea (Cambodia)",   
 "KZ": "Kazakstan",   
 "KE": "Kenya",   
 "KR": "Korea",   
 "KW": "Kuwait",   
 "KG": "Kyrgyzstan",   
 "LA": "Laos",   
 "LV": "Latvia",   
 "LB": "Lebanon",   
 "LS": "Lesotho",   
 "LR": "Liberia",   
 "LY": "Libya",   
 "LI": "Liechtenstein",   
 "LT": "Lithuania",   
 "LU": "Luxembourg",   
 "MO": "Macao",   
 "MG": "Madagascar",   
 "MW": "Malawi",   
 "MY": "Malaysia",   
 "MV": "Maldives",   
 "ML": "Mali",   
 "MT": "Malta",   
 "MU": "Mauritius",   
 "MX": "Mexico",   
 "MD": "Moldova",   
 "MC": "Monaco",   
 "MN": "Mongolia",   
 "MS": "Montserrat Is.",   
 "MA": "Morocco",   
 "MZ": "Mozambique",   
 "NA": "Namibia",   
 "NR": "Nauru",   
 "NP": "Nepal",   
 "NL": "Netherlands",   
 "NZ": "New Zealand",   
 "NI": "Nicaragua",   
 "NE": "Niger",   
 "NG": "Nigeria",   
 "KP": "North Korea",   
 "NO": "Norway",   
 "OM": "Oman",   
 "PK": "Pakistan",   
 "PA": "Panama",   
 "PG": "Papua New Cuinea",   
 "PY": "Paraguay",   
 "PE": "Peru",   
 "PH": "Philippines",   
 "PL": "Poland",   
 "PF": "French Polynesia",   
 "PT": "Portugal",   
 "PR": "Puerto Rico",   
 "QA": "Qatar",   
 "RO": "Romania",   
 "RU": "Russia",   
 "LC": "Saint Lueia",   
 "VC": "Saint Vincent",   
 "SM": "San Marino",   
 "ST": "Sao Tome and Principe",   
 "SA": "Saudi Arabia",   
 "SN": "Senegal",   
 "SC": "Seychelles",   
 "SL": "Sierra Leone",   
 "SG": "Singapore",   
 "SK": "Slovakia",   
 "SI": "Slovenia",   
 "SB": "Solomon Is.",   
 "SO": "Somali",   
 "ZA": "South Africa",   
 "ES": "Spain",   
 "LK": "Sri Lanka",   
 "SD": "Sudan",   
 "SR": "Suriname",   
 "SZ": "Swaziland",   
 "SE": "Sweden",   
 "CH": "Switzerland",   
 "SY": "Syria",   
 "TW": "Taiwan",   
 "TJ": "Tajikstan",   
 "TZ": "Tanzania",   
 "TH": "Thailand",   
 "TG": "Togo",   
 "TO": "Tonga",   
 "TT": "Trinidad and Tobago",   
 "TN": "Tunisia",   
 "TR": "Turkey",   
 "TM": "Turkmenistan",   
 "UG": "Uganda",   
 "UA": "Ukraine",   
 "AE": "United Arab Emirates",   
 "GB": "United Kiongdom",   
 "US": "United States of America",   
 "UY": "Uruguay",   
 "UZ": "Uzbekistan",   
 "VE": "Venezuela",   
 "VN": "Vietnam",   
 "YE": "Yemen",   
 "YU": "Yugoslavia",   
 "ZW": "Zimbabwe",   
 "ZR": "Zaire",   
 "ZM": "Zambia"  
 };
</script>

</body>
</html>
